{"version":3,"sources":["pages/ObjectDetection.js"],"names":["ObjectDetection","useState","locData","setLocData","selectedFile","setSelectedFile","model","setModel","detectedObjects","setDetectedObjects","objectDetectionIsOccuring","setObjectDetectionIsOccuring","selectedImageRef","useRef","requestFramRef","localizationService","LocalizationService","machineLearningService","MachineLearningService","modelUrl","useEffect","a","locCode","getUserLocale","getLocalizedTextSet","locDataLoaded","loadLocalization","tf","then","loadModel","modelUrlToLoad","fromTFHub","zeroTensor","executeAsync","result","Promise","all","map","t","data","dispose","console","log","handleImageObjectDetection","performImageObjectDetection","getTensorFromRawImage","img","fromPixels","expandDims","cast","tensorData","current","width","height","classes","getCocoSSDClasses","detectObjects","ObjectDetectionResult","length","className","object","class","probability","container","spacing","item","xs","objectdetection","objectdetectioninstructions","href","color","variant","target","rel","md","lg","xl","style","display","accept","multiple","id","type","onChange","e","file","files","reader","FileReader","onload","src","readAsDataURL","title","htmlFor","aria-label","component","fontSize","name","onClick","size","ref","visibility","alt"],"mappings":"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","file":"static/js/7.2918fdef.chunk.js","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\n// Tensorflow\nimport * as tf from '@tensorflow/tfjs';\n// material-ui\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport CardContent from '@material-ui/core/CardContent';\nimport Grid from '@material-ui/core/Grid';\nimport PublishSharpIcon from '@material-ui/icons/PublishSharp';\n// Components\nimport LoadingIndicator from 'components/Shared/LoadingIndicator';\n// Services\nimport LocalizationService from 'services/LocalizationService';\nimport MachineLearningService from 'services/MachineLearningService';\n\nexport default function ObjectDetection() {\n\tconst [locData, setLocData] = useState({});\n\tconst [selectedFile, setSelectedFile] = useState(null);\n\tconst [model, setModel] = useState();\n\tconst [detectedObjects, setDetectedObjects] = useState(null);\n\tconst [objectDetectionIsOccuring, setObjectDetectionIsOccuring] = useState(false);\n\n\tconst selectedImageRef = useRef(null);\n\tconst requestFramRef = useRef(0);\n\n\tconst localizationService = LocalizationService();\n\tconst machineLearningService = MachineLearningService();\n\n\t// Example: https://react-tensorflow-example.vercel.app/objects\n\t// and page: https://github.com/joshuaellis/react-tensorflow/blob/master/example/src/containers/PageObjects/index.tsx\n\t// https://github.com/joshuaellis/react-tensorflow/blob/master/src/hooks/useObjectDetect.ts\n\tconst modelUrl = 'https://tfhub.dev/tensorflow/tfjs-model/ssd_mobilenet_v2/1/default/1';\n\t//const model_net = await tf.loadGraphModel(\"https://tfhub.dev/tensorflow/tfjs-model/ssd_mobilenet_v2/1/default/1\", { fromTFHub: true })\n\n\tuseEffect(() => {\n\t\tasync function loadLocalization() {\n\t\t\tconst locCode = localizationService.getUserLocale();\n\n\t\t\tconst locDataLoaded = await localizationService.getLocalizedTextSet(\n\t\t\t\t['objectdetection', 'objectdetectiondescription', 'objectdetectioninstructions', 'moreinfo'],\n\t\t\t\tlocCode\n\t\t\t);\n\t\t\tsetLocData(locDataLoaded);\n\t\t}\n\t\tloadLocalization();\n\t}, []);\n\n\tuseEffect(() => {\n\t\ttf.ready().then(() => {\n\t\t\tloadModel(modelUrl);\n\t\t});\n\t}, [modelUrl]);\n\n\tconst loadModel = async (modelUrlToLoad) => {\n\t\ttry {\n\t\t\tconst model = await tf.loadGraphModel(modelUrlToLoad, { fromTFHub: true });\n\t\t\t// warm up model with empty image\n\t\t\tconst zeroTensor = tf.zeros([1, 300, 300, 3], 'int32');\n\t\t\tconst result = await model.executeAsync(zeroTensor);\n\t\t\tawait Promise.all(result.map((t) => t.data()));\n\t\t\tresult.map((t) => t.dispose());\n\t\t\tzeroTensor.dispose();\n\n\t\t\tsetModel(model);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n\t};\n\n\tconst handleSelectImage = (e) => {\n\t\tconst [file] = e.target.files;\n\t\tif (file) {\n\t\t\tconst reader = new FileReader();\n\t\t\tconst { current } = selectedImageRef;\n\t\t\tcurrent.file = file;\n\t\t\treader.onload = (e) => {\n\t\t\t\tcurrent.src = e.target.result;\n\t\t\t};\n\t\t\treader.readAsDataURL(file);\n\t\t\tsetSelectedFile(file);\n\t\t}\n\t};\n\n\tconst handleImageObjectDetection = async () => {\n\t\tsetObjectDetectionIsOccuring(true);\n\t\tawait performImageObjectDetection();\n\t};\n\n\tconst getTensorFromRawImage = (img) => {\n\t\tconst tensor = tf.tidy(() => {\n\t\t\tconst tens = tf.browser.fromPixels(img);\n\t\t\treturn tens.expandDims(0).cast('int32');\n\t\t});\n\t\treturn tensor;\n\t};\n\n\tconst performImageObjectDetection = async () => {\n\t\tconst tensorData = getTensorFromRawImage(selectedImageRef.current);\n\t\tconst width = selectedImageRef.current?.width ?? 0;\n\t\tconst height = selectedImageRef.current?.height ?? 0;\n\t\tconst classes = machineLearningService.getCocoSSDClasses();\n\t\tconst returns = 5;\n\t\tconst minConfidence = 0;\n\n\t\tconst detectedObjects = await machineLearningService.detectObjects(\n\t\t\tmodel,\n\t\t\ttensorData,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tclasses,\n\t\t\trequestFramRef,\n\t\t\treturns,\n\t\t\tminConfidence\n\t\t);\n\t\t\n\t\tsetDetectedObjects(detectedObjects);\n\n\t\tsetObjectDetectionIsOccuring(false);\n\t};\n\n\tconst ObjectDetectionResult = () => {\n\t\tif (!objectDetectionIsOccuring && detectedObjects && detectedObjects.length > 0) {\n\t\t\treturn (\n\t\t\t\t<Card className=\"card white-bg-color bl-1 bb-1\">\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t{detectedObjects.map((object) => (\n\t\t\t\t\t\t\t<div key={object.class}>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<span className=\"text-bold\">Classification:</span> {object.class}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<span className=\"text-bold\">Probability:</span> {object.probability}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t);\n\t\t} else {\n\t\t\treturn <></>;\n\t\t}\n\t};\n\n\treturn (\n\t\t<Grid container spacing={0}>\n\t\t\t<Grid item xs={12} className=\"contentpanel-site\">\n\t\t\t\t<h3>{locData.objectdetection}</h3>\n\t\t\t\t<p>\n\t\t\t\t\t{locData.objectdetectioninstructions}{' '}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"ml-2\"\n\t\t\t\t\t\thref={modelUrl}\n\t\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener\"\n\t\t\t\t\t>\n\t\t\t\t\t\tView Model\n\t\t\t\t\t</Button>\n\t\t\t\t</p>\n\t\t\t\t<Grid container spacing={0}>\n\t\t\t\t\t<Grid item xs={12} md={6} lg={6} xl={6}>\n\t\t\t\t\t\t<Card className=\"card white-bg-color bl-1 bb-1\">\n\t\t\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tstyle={{ display: 'none' }}\n\t\t\t\t\t\t\t\t\taccept=\"image/jpeg\"\n\t\t\t\t\t\t\t\t\tmultiple={false}\n\t\t\t\t\t\t\t\t\tid=\"faceImage\"\n\t\t\t\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\t\t\t\tonChange={handleSelectImage}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Tooltip title=\"Select Image\">\n\t\t\t\t\t\t\t\t\t<label htmlFor=\"faceImage\">\n\t\t\t\t\t\t\t\t\t\t<IconButton color=\"primary\" aria-label=\"upload image\" component=\"span\">\n\t\t\t\t\t\t\t\t\t\t\t<PublishSharpIcon fontSize=\"large\" />\n\t\t\t\t\t\t\t\t\t\t</IconButton>\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t<label>{selectedFile ? selectedFile.name : 'Select Image'}</label>. . .\n\t\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t\t\t<CardActions>\n\t\t\t\t\t\t\t\t{selectedFile ? (\n\t\t\t\t\t\t\t\t\t<Button color=\"primary\" onClick={() => handleImageObjectDetection()}>\n\t\t\t\t\t\t\t\t\t\tPerform Object Detection\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<></>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t<LoadingIndicator display={objectDetectionIsOccuring} size={40} />\n\t\t\t\t\t\t\t</CardActions>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t</Grid>\n\n\t\t\t\t\t<Grid item xs={12} md={6} lg={6} xl={6}>\n\t\t\t\t\t\t<ObjectDetectionResult />\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\tref={selectedImageRef}\n\t\t\t\t\t\t\tsrc={selectedFile}\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\twidth: '50%',\n\t\t\t\t\t\t\t\tvisibility: selectedFile != null ? 'visible' : 'hidden',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\talt=\"Selected file to analyze\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n}\n"],"sourceRoot":""}