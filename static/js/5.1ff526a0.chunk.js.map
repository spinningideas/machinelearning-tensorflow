{"version":3,"sources":["components/Shared/DownloadFileButton.js","pages/Classifier.js"],"names":["useStyles","makeStyles","theme","avatar","margin","spacing","DownloadFileButton","text","filePath","display","classes","className","color","target","style","visibility","title","href","download","alt","src","Classifier","useState","locData","setLocData","selectedFile","setSelectedFile","model","setModel","classificationText","setClassificationText","classificationProbabilityText","setClassificationProbabilityText","isClassificationOccuring","setIsClassificationOccuring","selectedImageRef","React","useRef","machineLearningService","MachineLearningService","localizationService","LocalizationService","modelUrl","modelUrlToLoad","a","tf","fromTFHub","console","log","useEffect","locCode","getUserLocale","getLocalizedTextSet","locDataLoaded","loadLocalization","then","loadModel","handleClassifyImage","performImageClassification","getTensorFromRawImage","rawImage","normalized","fromPixels","toFloat","mul","add","resizeBilinear","reshape","classify","tensor","returnAmount","values","slice","softmax","dataSync","valuesWithIndices","forEach","val","i","push","value","index","sort","b","filter","_","map","probability","current","predict","result","imageNetClasses","getImageNetClasses","prediction","dispose","ClassificationResult","length","container","item","xs","classifier","classifierinstructions","variant","rel","md","lg","xl","accept","multiple","id","type","onChange","e","file","files","reader","FileReader","onload","readAsDataURL","htmlFor","aria-label","component","fontSize","name","onClick","size","justifyContent","ref","width"],"mappings":"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","file":"static/js/5.1ff526a0.chunk.js","sourcesContent":["import React from 'react';\r\nimport Avatar from '@material-ui/core/Avatar';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n\tavatar: {\r\n\t\tmargin: theme.spacing(1),\r\n\t},\r\n}));\r\n\r\nfunction DownloadFileButton({ text, filePath, display }) {\r\n\tconst classes = useStyles();\r\n\treturn (\r\n\t\t<IconButton\r\n\t\t\tclassName=\"ml-2\"\r\n\t\t\tcolor=\"primary\"\r\n\t\t\ttarget=\"_blank\"\r\n\t\t\tstyle={{\r\n\t\t\t\tvisibility: display ? 'visible' : 'hidden',\r\n\t\t\t}}\r\n\t\t\ttitle={text}\r\n\t\t\thref={filePath}\r\n\t\t\tdownload\r\n\t\t>\r\n\t\t\t<Avatar className={classes.avatar} alt={text} src={filePath} />\r\n\t\t</IconButton>\r\n\t);\r\n}\r\n\r\nexport default DownloadFileButton;\r\n","import React, { useEffect, useState } from 'react';\n// Tensorflow\nimport * as tf from '@tensorflow/tfjs';\n// material-ui\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport CardContent from '@material-ui/core/CardContent';\nimport Grid from '@material-ui/core/Grid';\nimport PublishSharpIcon from '@material-ui/icons/PublishSharp';\n// Components\nimport LoadingIndicator from 'components/Shared/LoadingIndicator';\nimport DownloadFileButton from 'components/Shared/DownloadFileButton';\n// Services\nimport LocalizationService from 'services/LocalizationService';\nimport MachineLearningService from 'services/MachineLearningService';\n\nexport default function Classifier() {\n\tconst [locData, setLocData] = useState({});\n\tconst [selectedFile, setSelectedFile] = useState(null);\n\tconst [model, setModel] = useState();\n\tconst [classificationText, setClassificationText] = useState('');\n\tconst [classificationProbabilityText, setClassificationProbabilityText] = useState('');\n\tconst [isClassificationOccuring, setIsClassificationOccuring] = useState(false);\n\n\tconst selectedImageRef = React.useRef(null);\n\n\tconst machineLearningService = MachineLearningService();\n\tconst localizationService = LocalizationService();\n\n\tconst modelUrl = 'https://tfhub.dev/google/tfjs-model/imagenet/mobilenet_v2_140_224/classification/3/default/1';\n\n\tuseEffect(() => {\n\t\tasync function loadLocalization() {\n\t\t\tconst locCode = localizationService.getUserLocale();\n\n\t\t\tconst locDataLoaded = await localizationService.getLocalizedTextSet(\n\t\t\t\t['classifier', 'classifierdescription', 'classifierinstructions', 'moreinfo'],\n\t\t\t\tlocCode\n\t\t\t);\n\t\t\tsetLocData(locDataLoaded);\n\t\t}\n\t\tloadLocalization();\n\t}, []);\n\n\tuseEffect(() => {\n\t\ttf.ready().then(() => {\n\t\t\tloadModel(modelUrl);\n\t\t});\n\t}, [modelUrl]);\n\n\tasync function loadModel(modelUrlToLoad) {\n\t\ttry {\n\t\t\tconst model = await tf.loadGraphModel(modelUrlToLoad, { fromTFHub: true });\n\t\t\tsetModel(model);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n\t}\n\n\tconst handleSelectImage = (e) => {\n\t\tconst [file] = e.target.files;\n\t\tif (file) {\n\t\t\tconst reader = new FileReader();\n\t\t\tconst { current } = selectedImageRef;\n\t\t\tcurrent.file = file;\n\t\t\treader.onload = (e) => {\n\t\t\t\tcurrent.src = e.target.result;\n\t\t\t};\n\t\t\treader.readAsDataURL(file);\n\t\t\tsetSelectedFile(file);\n\t\t}\n\t};\n\n\tconst handleClassifyImage = async () => {\n\t\tsetIsClassificationOccuring(true);\n\t\tawait performImageClassification();\n\t};\n\n\tconst getTensorFromRawImage = (rawImage) => {\n\t\tconst image = tf.browser.fromPixels(rawImage);\n\t\tconst normalized = image\n\t\t\t.toFloat()\n\t\t\t.mul(2 / 255)\n\t\t\t.add(-1);\n\t\tlet resized = tf.image.resizeBilinear(normalized, [224, 224], true);\n\t\treturn resized.reshape([-1, 224, 224, 3]);\n\t};\n\n\tconst classify = (tensor, returnAmount, classes) => {\n\t\tconst values = tf.tidy(() => {\n\t\t\tconst softmax = tensor.slice([0, 1], [-1, 1000]).softmax();\n\t\t\treturn softmax.dataSync();\n\t\t});\n\n\t\tconst valuesWithIndices = [];\n\t\tvalues.forEach((val, i) => {\n\t\t\tvaluesWithIndices.push({ value: val, index: i });\n\t\t});\n\n\t\treturn valuesWithIndices\n\t\t\t.sort((a, b) => b.value - a.value)\n\t\t\t.filter((_, i) => i < returnAmount)\n\t\t\t.map(({ value, index }) => ({\n\t\t\t\tclassName: classes[index],\n\t\t\t\tprobability: value,\n\t\t\t}));\n\t};\n\n\tconst performImageClassification = async () => {\n\t\tconst tensor = getTensorFromRawImage(selectedImageRef.current);\n\t\tconst result = await model.predict(tensor);\n\t\tconst imageNetClasses = machineLearningService.getImageNetClasses();\n\t\tconst prediction = classify(result, 1, imageNetClasses);\n\n\t\ttensor.dispose();\n\t\tresult.dispose();\n\n\t\tsetClassificationText(prediction[0].className);\n\t\tsetClassificationProbabilityText(prediction[0].probability);\n\t\tsetIsClassificationOccuring(false);\n\t};\n\n\tconst ClassificationResult = () => {\n\t\tif (!isClassificationOccuring && classificationText.length > 0) {\n\t\t\treturn (\n\t\t\t\t<Card className=\"card white-bg-color bl-1 bb-1\">\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<span className=\"text-bold\">Classification:</span> {classificationText}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<span className=\"text-bold\">Probability:</span> {classificationProbabilityText}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t);\n\t\t} else {\n\t\t\treturn <></>;\n\t\t}\n\t};\n\n\treturn (\n\t\t<Grid container spacing={0}>\n\t\t\t<Grid item xs={12} className=\"contentpanel-site\">\n\t\t\t\t<h3>{locData.classifier}</h3>\n\t\t\t\t<p>\n\t\t\t\t\t{locData.classifierinstructions}{' '}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"ml-2\"\n\t\t\t\t\t\thref={modelUrl}\n\t\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener\"\n\t\t\t\t\t>\n\t\t\t\t\t\tView Model\n\t\t\t\t\t</Button>\n\t\t\t\t</p>\n\t\t\t\t<Grid container spacing={0}>\n\t\t\t\t\t<Grid item xs={12} md={6} lg={6} xl={6}>\n\t\t\t\t\t\t<Card className=\"card white-bg-color bl-1 bb-1\">\n\t\t\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tstyle={{ display: 'none' }}\n\t\t\t\t\t\t\t\t\taccept=\"image/jpeg\"\n\t\t\t\t\t\t\t\t\tmultiple={false}\n\t\t\t\t\t\t\t\t\tid=\"faceImage\"\n\t\t\t\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\t\t\t\tonChange={handleSelectImage}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Tooltip title=\"Select Image\">\n\t\t\t\t\t\t\t\t\t<label htmlFor=\"faceImage\">\n\t\t\t\t\t\t\t\t\t\t<IconButton color=\"primary\" aria-label=\"upload image\" component=\"span\">\n\t\t\t\t\t\t\t\t\t\t\t<PublishSharpIcon fontSize=\"large\" />\n\t\t\t\t\t\t\t\t\t\t</IconButton>\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t<label>{selectedFile ? selectedFile.name : 'Select Image'}</label>. . .\n\t\t\t\t\t\t\t\t<DownloadFileButton\n\t\t\t\t\t\t\t\t\tdisplay={true}\n\t\t\t\t\t\t\t\t\ttext=\"Download Bee Image\"\n\t\t\t\t\t\t\t\t\tfilePath=\"images/bee.jpg\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<DownloadFileButton\n\t\t\t\t\t\t\t\t\tdisplay={true}\n\t\t\t\t\t\t\t\t\ttext=\"Download Hot Dog Image\"\n\t\t\t\t\t\t\t\t\tfilePath=\"images/hotdog.jpg\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<DownloadFileButton\n\t\t\t\t\t\t\t\t\tdisplay={true}\n\t\t\t\t\t\t\t\t\ttext=\"Download strawberry Image\"\n\t\t\t\t\t\t\t\t\tfilePath=\"images/strawberry.jpg\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t\t\t<CardActions>\n\t\t\t\t\t\t\t\t{selectedFile ? (\n\t\t\t\t\t\t\t\t\t<Button color=\"primary\" onClick={() => handleClassifyImage()}>\n\t\t\t\t\t\t\t\t\t\tPerform Classification\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<></>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t<LoadingIndicator display={isClassificationOccuring} size={40} />\n\t\t\t\t\t\t\t</CardActions>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t\t<ClassificationResult />\n\t\t\t\t\t</Grid>\n\t\t\t\t\t<Grid item xs={12} md={6} lg={6} xl={6}>\n\t\t\t\t\t\t<Box display=\"flex\" justifyContent=\"center\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\tref={selectedImageRef}\n\t\t\t\t\t\t\t\tsrc={selectedFile}\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\twidth: '50%',\n\t\t\t\t\t\t\t\t\tvisibility: selectedFile != null ? 'visible' : 'hidden',\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\talt=\"Selected file to analyze\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n}\n"],"sourceRoot":""}